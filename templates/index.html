<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>AI Chatbot — Emotions</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f3f6fb;display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
    .card{width:420px;background:#fff;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.08);padding:16px;display:flex;flex-direction:column}
    .messages{flex:1;overflow:auto;padding:8px;margin-bottom:8px;border-radius:8px;background:#fafafa;height:380px}
    .msg{margin:8px 0;padding:10px;border-radius:10px;max-width:80%}
    .you{background:#cfe9ff;margin-left:auto;text-align:right}
    .bot{background:#e6ffe6;margin-right:auto;text-align:left}
    .meta{font-size:12px;color:#666;margin-top:6px}
    .input-row{display:flex;gap:8px}
    input{flex:1;padding:10px;border-radius:8px;border:1px solid #ddd}
    button{padding:10px 14px;border-radius:8px;border:none;background:#007bff;color:#fff;cursor:pointer}
  </style>
</head>
<body>
  <div class="card">
    <h3>Cloud-Native AI Chatbot</h3>
    <div id="messages" class="messages"></div>
    <div class="input-row">
      <input id="text" placeholder="Type your message..." />
      <button id="send">Send</button>
    </div>
  </div>

  <script>
    const messages = document.getElementById('messages');
    const input = document.getElementById('text');
    const send = document.getElementById('send');

    function addMessage(content, cls, meta="") {
      const d = document.createElement('div');
      d.className = 'msg ' + cls;
      d.innerHTML = `<div>${content}</div>` + (meta? `<div class="meta">${meta}</div>` : '');
      messages.appendChild(d);
      messages.scrollTop = messages.scrollHeight;
    }

    async function sendMessage() {
      const text = input.value.trim();
      if (!text) return;
      addMessage(text, 'you');
      input.value = '';
      try {
        const res = await fetch('/chat', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({message: text})
        });
        if (!res.ok) {
          const err = await res.text();
          addMessage("Error: " + err, 'bot');
          return;
        }
        const data = await res.json();
        addMessage(data.bot_response, 'bot', `Emotion: ${data.emotion} • Score: ${data.textblob_score} • ${data.transformer_label} (${data.transformer_confidence})`);
      } catch (e) {
        addMessage("Network error: " + e.message, 'bot');
      }
    }

    send.addEventListener('click', sendMessage);
    input.addEventListener('keydown', (e)=> { if (e.key==='Enter') sendMessage(); });
  </script>
</body>
</html>
